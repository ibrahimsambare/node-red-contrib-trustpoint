<script type="text/html" data-template-name="trustpoint-simplereenroll">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Node name">
    </div>

    <div class="form-row">
        <label for="node-input-clientCert"><i class="fa fa-certificate"></i> Client Certificate (PEM)</label>
        <input type="text" id="node-input-clientCert" placeholder="msg.payload.clientCert or inline PEM" style="width: 100%;">
        <input type="hidden" id="node-input-clientCert_fieldType">
    </div>

    <div class="form-row">
        <label for="node-input-clientKey"><i class="fa fa-key"></i> Private Key (PEM)</label>
        <input type="text" id="node-input-clientKey" placeholder="msg.payload.clientKey or inline PEM" style="width: 100%;">
        <input type="hidden" id="node-input-clientKey_fieldType">
    </div>

    <div id="reenroll-preview" class="validation-result">
        <div class="validation-box" id="reenroll-preview-box">
            This node expects `msg.payload.estBaseUrl`, and optionally clientCert/clientKey if not set above.
        </div>
    </div>

</script>

<style>
    .validation-box {
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
        font-weight: normal;
    }

    .validation-info {
        background-color: #4cafaf;
        color: white;
    }
</style>

<script type="text/javascript">
    (function () {
        RED.nodes.registerType('trustpoint-simplereenroll', {
            category: 'Trustpoint',
            color: '#ccccff',
            defaults: {
                name: { value: "" },
                clientCert: { value: "", required: false },
                clientCert_fieldType: { value: "str" },
                clientKey: { value: "", required: false },
                clientKey_fieldType: { value: "str" }
            },
            inputs: 1,
            outputs: 1,
            icon: "font-awesome/fa-refresh",
            label: function () {
                return this.name || "trustpoint-simplereenroll";
            },
            labelStyle: function () {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function () {
                $("#node-input-clientCert").typedInput({
                    default: 'str',
                    types: ['str', 'msg', 'flow', 'global'],
                    typeField: $("#node-input-clientCert_fieldType")
                });

                $("#node-input-clientKey").typedInput({
                    default: 'str',
                    types: ['str', 'msg', 'flow', 'global'],
                    typeField: $("#node-input-clientKey_fieldType")
                });

                $("#reenroll-preview-box").addClass("validation-info");
            }
        });
    })();
</script>
